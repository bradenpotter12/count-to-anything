<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Count To Anything</title>
  <style>
    h1 {
      font-family: Arial, Helvetica, sans-serif;
      text-align: center;
    }

    button {
      border-radius: 6px;
      font-size: large;
    }

    .start-stop-buttons {
      margin-top: 30px;
      text-align: center;
    }

    .number-input {
      margin-top: 30px;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    input {
      padding: 3.8px 15px;
      border-radius: 25px;
    }
  </style>
</head>
<body>
  <h1>Count To <span class="max-number">Anything</span></h1>
  <h1 class="counter"></h1>
  <div class="start-stop-buttons">
    <button class="slower-button"><<</button>
    <button class="start-stop-button start">Start</button>
    <button class="faster-button">>></button>
    <button class="reset-button">Reset</button>
  </div>
  <div class="number-input">
    <input class="input-field">
    <button class="submit-button">Enter</button>  
  </div>
  <script>
    // Elements
    let maxNumberSpanElement = document.querySelector('.max-number');
    let numberDisplayed = document.querySelector('.counter');
    let startStopButton = document.querySelector('.start-stop-button');

    // State Data
    let count = Number(localStorage.getItem('count'));
    let counterIsRunning = JSON.parse(localStorage.getItem('counterIsRunning'));
    let intervalId;
    
    {
      let maxNumber = localStorage.getItem('maxNumber'); 
      
      if (maxNumber != null) {
        maxNumberSpanElement.innerHTML = Number(maxNumber).toLocaleString()
      } else {
        maxNumberSpanElement.innerHTML = "Anything";
      }
      
      if (maxNumber != null && count >= Number(maxNumber)) {
        numberDisplayed.innerHTML = maxNumber.toLocaleString();
      } else {
        numberDisplayed.innerHTML = Number(localStorage.getItem('count')).toLocaleString();
      }
    }

    if (counterIsRunning) {
      updateCount();
      let milliseconds = Number(localStorage.getItem('milliseconds'));
      startCounter(milliseconds);
      startStopButton.classList.remove('start');
      startStopButton.innerHTML = 'Stop';
    }

    let slowerButton = document.querySelector('.slower-button');
    slowerButton.addEventListener('click', () => {
      counterIsRunning = JSON.parse(localStorage.getItem('counterIsRunning'));

      if (counterIsRunning) {
        stopCounter();
        let milliseconds = Number(localStorage.getItem('milliseconds'));
        if (milliseconds < 1000) {
          milliseconds *= 10;
        }
        startCounter(milliseconds);
        localStorage.setItem('milliseconds', milliseconds.toString());
        count = localStorage.getItem('count');
        localStorage.setItem('countWhenNewCounterStarted', count);
        localStorage.setItem('timeStampWhenNewCounterStarted', Date.now().toString());
      }
    });

    let fasterButton = document.querySelector('.faster-button');
    fasterButton.addEventListener('click', () => {
      counterIsRunning = JSON.parse(localStorage.getItem('counterIsRunning'));

      if (counterIsRunning) {
        stopCounter();
        let milliseconds = Number(localStorage.getItem('milliseconds'));
        if (milliseconds > 1) {
          milliseconds /= 10;
        }
        startCounter(milliseconds);
        localStorage.setItem('milliseconds', milliseconds.toString());
        count = localStorage.getItem('count');
        localStorage.setItem('countWhenNewCounterStarted', count);
        localStorage.setItem('timeStampWhenNewCounterStarted', Date.now().toString());
      }
    });
    
    startStopButton.addEventListener('click', () => {
      if (startStopButton.classList.contains('start')) {
        startStopButton.classList.remove('start');
        startStopButton.innerHTML = 'Stop';
        if (count === 0) {
          let timeStamp = Date.now();
          localStorage.setItem('startTime', timeStamp.toString());
          startCounter(1000);
          localStorage.setItem('milliseconds', '1000');
        } else {
          let milliseconds = localStorage.getItem('milliseconds');
          startCounter(Number(milliseconds));
        }
      } else {
        startStopButton.classList.add('start');
        startStopButton.innerHTML = 'Start';
        stopCounter();
      }
    });

    let resetButton = document.querySelector('.reset-button');
    resetButton.addEventListener('click', () => {
      document.querySelector('.max-number').innerHTML = "Anything";
      localStorage.removeItem('maxNumber');
      resetCounter();
      localStorage.removeItem('countWhenNewCounterStarted');
      localStorage.removeItem('timeStampWhenNewCounterStarted');
      startStopButton.classList.add('start');
      startStopButton.innerHTML = 'Start';
    });

    let submitButton = document.querySelector('.submit-button');
    submitButton.addEventListener('click', () => {
      let inputElement = document.querySelector('.input-field');
      let maxNumberString = inputElement.value;
      maxNumberSpanElement.innerHTML = Number(maxNumberString).toLocaleString();
      inputElement.value = '';
      resetCounter();
      localStorage.setItem('maxNumber', maxNumberString);
    });

    function updateCount() {
      let startTime = JSON.parse(localStorage.getItem('startTime'));
      let currentTime = Date.now();
      let timeStampWhenNewCounterStarted = JSON.parse(localStorage.getItem('timeStampWhenNewCounterStarted')) || startTime;
      let countWhenNewCounterStarted = Number(localStorage.getItem('countWhenNewCounterStarted'));
      let milliseconds = Number(localStorage.getItem('milliseconds'));
      count = Math.round((currentTime - timeStampWhenNewCounterStarted) / milliseconds) + countWhenNewCounterStarted;
      console.log('startTime: ' + startTime);
      console.log('currentTime: ' + currentTime);
    }

    function startCounter(milliseconds) {
      localStorage.setItem('counterIsRunning', JSON.stringify(true));

      intervalId = setInterval(() => {
        count++;
        numberDisplayed.innerHTML = count.toLocaleString();
        localStorage.setItem('count', count);

        let maxNumber = Number(localStorage.getItem('maxNumber'));
        if (count >= maxNumber) {
          stopCounter();
          numberDisplayed.innerHTML = Number(maxNumber).toLocaleString();
          startStopButton.classList.add('start');
          startStopButton.innerHTML = 'Start'; 
        }
      }, milliseconds);
    }

    function stopCounter() {
      clearInterval(intervalId);
      localStorage.setItem('counterIsRunning', JSON.stringify(false));
    }

    function resetCounter() {
      stopCounter();
      document.querySelector('.counter').innerHTML = 0;
      count = 0;
      localStorage.setItem('count', count.toString());
    }
  </script>
</body>
</html>